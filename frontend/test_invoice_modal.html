<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Module Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }

        .test-box {
            background: #f0f0f0;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
        }

        .success {
            background: #d4edda;
            color: #155724;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
        }

        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            background: #007bff;
            color: white;
            font-size: 14px;
        }

        button:hover {
            background: #0056b3;
        }

        pre {
            background: #282c34;
            color: #abb2bf;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>

<body>
    <h1>üß™ Invoice Module Loading Test</h1>

    <div class="test-box" id="scriptLoadTest">
        <h3>Test 1: Script Loading</h3>
        <p>Checking if invoice.js script loaded...</p>
    </div>

    <div class="test-box" id="moduleExistsTest">
        <h3>Test 2: Module Object Exists</h3>
        <p>Checking if window.InvoiceModule exists...</p>
    </div>

    <div class="test-box" id="functionsExistTest">
        <h3>Test 3: Module Functions Exist</h3>
        <p>Checking if functions are defined...</p>
    </div>

    <div class="test-box" id="manualTest">
        <h3>Test 4: Manual Function Call</h3>
        <button onclick="testOpenModal()">üß™ Test Open Modal</button>
        <button onclick="testCloseModal()">üß™ Test Close Modal</button>
        <p id="manualTestResult"></p>
    </div>

    <div class="test-box">
        <h3>Console Output</h3>
        <p>Check browser console (F12) for detailed logs</p>
        <pre id="consoleOutput"></pre>
    </div>

    <!-- Define API_BASE before loading invoice.js -->
    <script>
        window.API_BASE = 'http://localhost:8000/api';
    </script>

    <!-- Include the invoice.js script -->
    <script src="invoice.js"></script>

    <script>
        let logs = [];

        // Override console.log to capture output
        const originalLog = console.log;
        console.log = function (...args) {
            originalLog.apply(console, args);
            logs.push(args.join(' '));
            updateConsoleOutput();
        };

        function updateConsoleOutput() {
            document.getElementById('consoleOutput').textContent = logs.join('\n');
        }

        function runTests() {
            console.log('=== Running Tests ===');

            // Test 1: Script loaded
            const test1 = document.getElementById('scriptLoadTest');
            test1.className = 'test-box success';
            test1.innerHTML = '<h3>‚úÖ Test 1: Script Loading</h3><p>invoice.js script loaded successfully</p>';
            console.log('‚úÖ Test 1 passed: Script loaded');

            // Test 2: Module exists
            const test2 = document.getElementById('moduleExistsTest');
            if (window.InvoiceModule) {
                test2.className = 'test-box success';
                test2.innerHTML = '<h3>‚úÖ Test 2: Module Object Exists</h3><p>window.InvoiceModule is defined</p>';
                console.log('‚úÖ Test 2 passed: Module exists');
                console.log('Module contents:', Object.keys(window.InvoiceModule));
            } else {
                test2.className = 'test-box error';
                test2.innerHTML = '<h3>‚ùå Test 2: Module Object Exists</h3><p>window.InvoiceModule is NOT defined</p>';
                console.error('‚ùå Test 2 failed: Module does not exist');
            }

            // Test 3: Functions exist
            const test3 = document.getElementById('functionsExistTest');
            if (window.InvoiceModule) {
                const hasInit = typeof window.InvoiceModule.init === 'function';
                const hasOpen = typeof window.InvoiceModule.open === 'function';
                const hasClose = typeof window.InvoiceModule.close === 'function';

                if (hasInit && hasOpen && hasClose) {
                    test3.className = 'test-box success';
                    test3.innerHTML = `
                        <h3>‚úÖ Test 3: Module Functions Exist</h3>
                        <ul>
                            <li>init: ‚úÖ ${typeof window.InvoiceModule.init}</li>
                            <li>open: ‚úÖ ${typeof window.InvoiceModule.open}</li>
                            <li>close: ‚úÖ ${typeof window.InvoiceModule.close}</li>
                        </ul>
                    `;
                    console.log('‚úÖ Test 3 passed: All functions exist');
                } else {
                    test3.className = 'test-box error';
                    test3.innerHTML = `
                        <h3>‚ùå Test 3: Module Functions Exist</h3>
                        <ul>
                            <li>init: ${hasInit ? '‚úÖ' : '‚ùå'} ${typeof window.InvoiceModule.init}</li>
                            <li>open: ${hasOpen ? '‚úÖ' : '‚ùå'} ${typeof window.InvoiceModule.open}</li>
                            <li>close: ${hasClose ? '‚úÖ' : '‚ùå'} ${typeof window.InvoiceModule.close}</li>
                        </ul>
                    `;
                    console.error('‚ùå Test 3 failed: Some functions missing');
                }
            } else {
                test3.className = 'test-box error';
                test3.innerHTML = '<h3>‚ùå Test 3: Module Functions Exist</h3><p>Cannot test - module does not exist</p>';
            }

            console.log('=== Tests Complete ===');
        }

        function testOpenModal() {
            const result = document.getElementById('manualTestResult');
            try {
                if (window.InvoiceModule && window.InvoiceModule.open) {
                    console.log('Attempting to call InvoiceModule.open()...');
                    window.InvoiceModule.open();
                    result.innerHTML = '<span style="color: green;">‚úÖ Successfully called InvoiceModule.open()</span>';
                } else {
                    throw new Error('InvoiceModule.open not found');
                }
            } catch (error) {
                console.error('Error calling open:', error);
                result.innerHTML = `<span style="color: red;">‚ùå Error: ${error.message}</span>`;
            }
        }

        function testCloseModal() {
            const result = document.getElementById('manualTestResult');
            try {
                if (window.InvoiceModule && window.InvoiceModule.close) {
                    console.log('Attempting to call InvoiceModule.close()...');
                    window.InvoiceModule.close();
                    result.innerHTML = '<span style="color: green;">‚úÖ Successfully called InvoiceModule.close()</span>';
                } else {
                    throw new Error('InvoiceModule.close not found');
                }
            } catch (error) {
                console.error('Error calling close:', error);
                result.innerHTML = `<span style="color: red;">‚ùå Error: ${error.message}</span>`;
            }
        }

        // Run tests after page loads
        window.addEventListener('load', function () {
            console.log('Page loaded, running tests in 100ms...');
            setTimeout(runTests, 100);
        });
    </script>
</body>

</html>